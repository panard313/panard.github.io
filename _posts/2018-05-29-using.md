---
layout: article
title: Common Note 简单记
key: 20180529
tags:
  - Common note
  - cx
lang: zh-Hans
---

# Android Phone

## termux

### ssh via adb
- pkg install openssh (need pkg upgrade first)
- sshd
- adb forward tcp:8022 tcp:8022
- ssh -p 8022 root@localhost  (maybe need passwd root first)

### termux sdcard permission
'''shell
termux-setup-storage
'''

### java dev
```shell
pkg install ecj dx
```

```java
public class Hello {
  public static void main(String[] args) {
    System.out.println("Hellod, on termux!");
  }
}
```
```shell
$ ecj Hello.java
$ dx --dex --output=Hello.dex Hello.class
$ dalvikvm -cp Hello.dex Hello
Hello world, on termux!
```

### c dev
>pkg install clang


## nexus 6p:

### [nexus 6p 时间同步](settings put global ntp_server time.asia.apple.com)

### [nexus 6p 去叹号](settings put global captive_portal_mode 0)

### mismatch vendor:
- [bootloop patch](https://forum.xda-developers.com/nexus-6p/general/nexus-6p-vendor-bootloader-radio-t3776039)

### lunch output:
```shell
  PLATFORM_VERSION_CODENAME=REL
  PLATFORM_VERSION=8.1.0
  TARGET_PRODUCT=aosp_angler
  TARGET_BUILD_VARIANT=userdebug
  TARGET_BUILD_TYPE=release
  TARGET_PLATFORM_VERSION=OPM1
  TARGET_BUILD_APPS=
  TARGET_ARCH=arm64
  TARGET_ARCH_VARIANT=armv8-a
  TARGET_CPU_VARIANT=cortex-a53
  TARGET_2ND_ARCH=arm
  TARGET_2ND_ARCH_VARIANT=armv7-a-neon
  TARGET_2ND_CPU_VARIANT=cortex-a53.a57
  HOST_ARCH=x86_64
  HOST_2ND_ARCH=x86
  HOST_OS=linux
  HOST_OS_EXTRA=Linux-4.4.0-127-generic-x86_64-with-Ubuntu-16.04-xenial
  HOST_CROSS_OS=windows
  HOST_CROSS_ARCH=x86
  HOST_CROSS_2ND_ARCH=x86_64
  HOST_BUILD_TYPE=release
  BUILD_ID=OPM3.171019.016
  OUT_DIR=out
  AUX_OS_VARIANT_LIST=
```




### tools:
- [android image tool: ](https://github.com/osm0sis/Android-Image-Kitchen.git)



## github pages
- [themes :  jekyll Text theme](https://github.com/kitian616/jekyll-TeXt-theme.git)


# vim skills

- 删除行尾空格
  :%s/\s\+$//g

- 删除空行
  :%s/^\s$/d

- 快速移动当前行位置

    - zt move the current line to the top of screen
    - zb move the current line to the bottom of screen
    - zz move the current line to the middle of screen


# Linux Cmd

### tmux 光标消失
  执行: tput cnorm

### cli tiips

- 处理带空格的文件名

  IFS=$'\n';for i in `ls`;do adb push $i /sdcar/Music/;done

### linux手动释放cache

- 1. 确认当前的drop_caches时候为默认值“0”
  more /proc/sys/vm/drop_caches 
  0

- 2.手动执行sync命令，确保系统的完整性，将所有未写的系统缓冲区写到磁盘中，包含已修改的i-node、已延迟的块I/O和读写映射文件
  sync

- 3.手动释放cache
  echo 3 > /proc/sys/vm/drop_caches

- 另：
- release pagecache
  echo 1 > /proc/sys/vm/drop_caches;

- release dentries and inodes
  echo 2 > /proc/sys/vm/drop_caches;

- relase pagecache, dentries and inodes
  echo 3 >/proc/sys/vm/drop_caches.


# win10

### dual boot disable fast startup
----How to enable and disable fast startup on Windows 10

If you'd like to see how your PC performs without fast startup enabled, you can disable it in just a few steps:

    Right-click the Start button.

- Click Search.
- Right-click the Start button. Click Search.
- Type Control Panel and hit Enter on your keyboard.
- Click Power Options.
- Type Control Panel. Click Power Options.
- Click Choose what the power buttons do.
- Click Change settings that are currently unavailable.
- Click Choose what the power buttons do. Click Change settings that are currently unavailable.
- Click Turn on fast startup (recommended) so that the checkmark disappears.
- Click Save changes.
- Click Turn on fast startup. Click Save changes.


### 卸载kms

- 首先要卸载掉KMS的程序。

方法是在控制面板，卸载程序，找到相应的KMS激活程序就可以了，比如KMS10，OEM7等等
- 卸载完成之后，打开管理员命令提示符。

  方法一：按键盘上的win+X+A，如果设置了用户控制的选择允许就可以打开了。
  方法二：在开始菜单搜索CMD，右键，选择以管理员身份运行，同样如果设置了用户控制的选择允许就可以打开了。
  依次输入以下命令
  slmgr /upk
  slmgr /ckms
  slmgr /rearm
  输入完成后会显示需要重启，重启就可以了。（是重启，不是关机后开机）
- 重启完成后，打开服务（win+R输入services.msc），向下拉，找到Software Protection这个服务，然后右击它，按属性。在打开的窗口会显示服务状态，在下面，会有启动的按钮，按下它就可以了。

这样就可以清除掉windows的KMS激活信息了

- 下面介绍如何清除office的KMS的激活信息，先卸载掉KMS这个程序，参照上面的方法。

然后还是上面的方法打开管理员命令提示符，输入cscript "C:\Program Files\Microsoft Office\Office16\OSPP.VBS" /dstatus（如果是office2016就是office16，如果是office2013就是office15……）（还有如果是64位系统装32位的office，Program Files需要改成Program Files (x86)）

如果有显示KMS字样的，就说明是KMS激活的。
- 继续输入cscript "C:\Program Files\Microsoft Office\Office16\OSPP.VBS" /unpkey:XXXXX（XXXXX为上面KMS激活KEY的后五位）（如果是office2016就是office16，如果是office2013就是office15……）（还有如果是64位系统装32位的office，Program Files需要改成Program Files (x86)）
- 最后再输入cscript "C:\Program Files\Microsoft Office\Office16\OSPP.VBS" /remhst（同样如果是office2016就是office16，如果是office2013就是office15……）（还有如果是64位系统装32位的office，Program Files需要改成Program Files (x86)）
- 这样就清除了office的KMS激活信息了


# Android

### 全部授权
```java
PackageManagerService.java
    private void grantPermissionsLPw(PackageParser.Package pkg, boolean replace,
        String packageOfInterest) {
            if (DEBUG_PERMISSIONS) {
                Slog.i(TAG, "Granting permission " + perm + " to package " + pkg.packageName);
            }

            // debug CX____, enable all permissions for all packages
            grant = GRANT_INSTALL;

            if (grant != GRANT_DENIED) {
            }
    }
```

### emulator 启动编译的镜像
```shell
    #~/workspace/android/android-aosp-sdk中，下面的命令将启动emulator，其中：
    #-avd参数用于指明虚拟设备名，参考图1-4，我们选择的是innost-7.0这个虚拟设备
    #-system参数指明系统镜像的路径，我们使用自己编译得到的系统镜像文件
    ~/workspace/android/android-aosp-sdk/tools/emulator \
    -avd innost-7.0 -nojni -writable-system -system `pwd`/out/target/product/innost_x86/system.img
```

### debug

#### debuggerd -b <pid> 打印堆栈 native

#### “kill -3 pid”来打印System_Server进程各个线程的Java调用栈


### perf_test push 

  git push ssh://xiong.chen@sz.gerrit.tclcom.com:29418/gcs_sz/perf_auto_test.git HEAD:refs/for/master

  git clone git@shenzhen.gitweb.com:gcs_sz/perf_auto_test.git

### play animations
```shell
adb shell "setprop sys.powerctl 1;setprop service.bootanim.exit 0;setprop ctl.start bootanim;sleep 6;setprop service.bootanim.exit 1"
```

### python 脚本

  MSM8940-LA-3.0.1-common-dint/tools/test/connectivity/acts/framework/acts/utils.py

## power

#### 1、 问下你们除了DOZE你们还有其他优化待机的解决方案吗？

- 1.1目前不确定你们开启了appstandby没，看不到你们代码。   <bool name="config_enableAutoPowerModes">true</bool>    貌似公司不少项目都没开，不确定是不是因为没加白名单的原因, 因而也去掉了ligtdoze。

进入lightdoze时加入白名单（一般社交类），然后进入deepdoze（或者累加触发1-2个窗口期）移除白名单，很多友商都这么做。另外，不少厂家直接跳过sensor的检测，防止稍微一抖就退出(比如骑车)

- 1.2 job的时间可以调整下 JobInfo.java
```java
//private static final long MIN_PERIOD_MILLIS = 15 * 60 * 1000L;   // 15 minutes

private static final long MIN_PERIOD_MILLIS = 45 * 60 * 1000L;   // 45 minutes
```

- 1.3扩大对齐唤醒的时间，让更多的alarm对齐唤醒

   AlarmManagerService.java系统的对齐时间是0.75*futurity，比如可以改为0.95*futurity
 

#### 2、亮屏使用功耗有些什么解决方案吗？

- 2.1、进行cpu,gpu的策略调整。具体值可项目实际调试测试，平衡性能。

- 2.2 aal对比度

  通过提高对比度降低背光，这个对性能不会有影响。微调一般感受不到背光变化。

- 2.3 后台应用申请位置信息的更新的间隔，比如30分钟改为1小时
```java
private static final long DEFAULT_MIN_INTERVAL_MS = 30 * 60 * 1000; // 30 minutes
```

# macos
[install macos in proxmox](https://www.nicksherlock.com/2018/06/installing-macos-mojave-on-proxmox/)
